# DB

I'm going to focus on SQL queries,
because the conceptual part of database is too large.

# SQL

## SQL(Structured Query Language)

포괄적 데이터베이스 언어로, 데이터 정의, 질의, 갱신을 위한 구문들을 가지고 있다. 따라서 SQL은 데이터 정의어(DDL)와 데이터 조작어(DML)을 모두 포함한다.

## CREATE TABLE 문
릴레이션의 이름과 함께 애트리뷰트와 초기 제약조건들을 명시하여 새 릴레이션 생성에 사용한다.

```sql
CREATE TABLE TABLE_NAME (
        <애트리뷰트명>  데이터타입 [옵션],
        <애트리뷰트명>  데이터타입 [옵션],
        <애트리뷰트명>  데이터타입 [옵션],
        ...

        [CONSTRAINT 제약조건명1] PRIMARY KEY(애트리뷰트명)
        [CONSTRAINT 제약조건명2] FOREIGN KEY(애트리뷰트명) REFERENCES <참조테이블명> (참조 애트리뷰트명)
);
```

  - 키 제약조건, 엔티티 무결성 제약조건, 참조 무결성 제약조건의 추가

    - 애트리뷰트들이 선언된 이후 CREATE TABLE 구문 안에서 표현되거나
    - 나중에 ALTER TABLE을 통해 표현한다.

  - 옵션
    - NOT NULL : 널 값 허용 안 함
    - DEFAULT \<VALUE\> : 애트리뷰트의 기본값 명시
    - CHECK : 애트리뷰트나 도메인 값을 제한
    - UNIQUE : 서로 다른 투플은 같은 애트리뷰트 값을 가질 수 없다. 기본키를 제외한 나머지 키를 나타낸다.

  - 외래키 사용시 주의사항
    - 외래키를 순환 참조하도록 선언하거나
    - 아직 생성되지 않은 테이블을 참조하면 참조 무결성 제약조건 위반으로 오류가 발생한다.
  => 해결 : 초기 CREATE TABLE문에서는 생성하지 않고 ALTER TABLE 구문을 사용해 나중에 추가한다.

## SELECT 문
SQL에서는 릴레이션과 달리 모든 열 값이 동일한 행을 하나 이상 가질 수 있다. (중복 레코드 허용)
관계대수의 σ 연산과는 다르다.

```sql
  SELECT <애트리뷰트 리스트> 혹은 *
  FROM <테이블 리스트>
  [WHERE <조건1> [AND <조건2> OR ...]]
  [ORDER BY <애트리뷰트 리스트>];
```

  - 구조
    - SELECT 절은 프로젝션 애트리뷰트라고 불리는 값을 검색할 애트리뷰트 값으로 명시한다.
    - WHERE 절은 선택 조건이라 불리는 검색될 튜플들이 만족해야할 조건을 명시하며 생략이 가능하다.
    또한 여러 조건문을 AND로 연결할 수 있다.

  - 모호한 애트리뷰트 처리
    동일한 이름을 갖는 애트리뷰트가 여러 릴레이션에 사용되면 모호함이 발생한다.
    => \<테이블명\>.\<애트리뷰트명\> 으로 참조한다.

  - 중복 투플의 처리
    SQL은 질의에서 중복 투플을 자동으로 제거하지 않는다. 그 이유로는
    1. 정렬을 한 후 제거해야 하므로 중복을 없애는데 시간이 많이 든다.
    2. 사용자가 중복 투플을 원할 수 있다.
    3. 집단함수(AGGREGATE FUNCTION) 사용 시 중복삭제가 필요하지 않다.
    중복 투플을 제거하려면 SELECT DISTINCT 문을 SELECT 대신 사용한다.

  - 집합 연산
  SELECT문의 결과를 가지고 다양한 집합 연산을 할 수 있도록 제공해준다.
    - UNION(합집합), EXCEPT(차집합), INTERSECT(교집합) 연산 제공
    - 집합 연산(set operation)의 결과는 투플의 집합(set)으로 제공되므로 중복 투플을 허용하지 않는다.
    - 두 집합이 합집합 호환성(두 릴레이션의 애트리뷰트가 동일함)을 가질 때에만 연산이 가능하다.


## INSERT, DELETE, UPDATE 문
  - INSERT

```sql
  INSERT INTO <테이블명> VALUES <애트리뷰트 리스트>;
```

```sql
  INSERT INTO <테이블명>(애트리뷰트1, 애트리뷰트2, ..., 애트리뷰트k)
  VALUES <애트리뷰트1 값, 애트리뷰트2 값, ..., 애트리뷰트k 값>
```

  * DELETE

    * 한번에 하나의 테이블 내의 투플만 삭제하는 것이 기본이다.
    * 그러나 CASCADE 등 특별한 조건이 있다면 다른 테이블에 있는 투플도 삭제하거나 변경할 수 있다.
    * WHERE 절을 생략하면 테이블 내의 모든 투플이 제거된다.
    * 테이블 정의를 제거하기 위해서는 DROP TABLE 명령을 이용한다.

```sql
  DELETE FROM <테이블명> WHERE <조건>;
```

  - UPDATE

    - 한 번에 하나의 테이블 내의 투플만 갱신하는 것이 기본이다.
    - 그러나 CASCADE 등 특별한 조건이 있다면 다른 테이블에 있는 투플도 갱신할 수 있다.

```sql
  UPDATE <테이블명>
  SET <애트리뷰트명> = <새 값>
  WHERE <조건>;
```


